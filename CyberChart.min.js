/*
* Project: CyberChart
* Version: 1.0.0 (2013-12-12 14:09)
* Development By: Jasper <jasperke@kinghood.com.tw>
* Copyright(c): 2013
*/
!function(a){"use strict";function b(a,b,c){this._element="string"==typeof a?$("#"+a):$(a),this._data=b,this.options={width:1e3,height:840,barWidth:.6,xTitle:"",yTitle:"",xLength:760,yLength:500,xyLineWidth:2,yScale:[0,5,10,15,20,25,30],type:"bar",barColor:"rgba(180,180,180,0.7)",canvasColor:"#ffffff",brokenLineColor:"rgba(160,160,160,0.7)",brokenLineWidth:16,dot:!0,dotColor:"#ffffff",dotStrokeWidth:12,dotStrokeColor:"rgba(100,100,100,0.7)",dotRadius:7,scaleLineColor:"#000000",scaleLineWidth:2,fontColor:"#000000"},$.extend(this.options,c),this._prepare()}var c=a.CyberChart;b.prefixZero=function(a){return a>=10?a:"0"+a},b.noConflict=function(){return a.CyberChart=c,b},b.prototype={_prepare:function(){this.set({xLength:this.get("width")-190-50,yLength:this.get("height")-100-240});var a=$("<canvas/>").attr({width:this.get("width"),height:this.get("height")}).appendTo(this._element);this._context2d=a.get(0).getContext("2d"),this._context2d.setLineDash||(this._context2d.setLineDash=$.proxy(function(a){this._context2d.mozDash=a,this._context2d.webkitLineDash=a},this)),this._drawBase(),this._drawXTitle(),this._drawYTitle(),this._drawData()},_setLineDashOffset:function(a){this._context2d.lineDashOffset=a,this._context2d.mozDashOffset=a,this._context2d.webkitLineDashOffset=a},set:function(a){for(var b in a)a.hasOwnProperty(b)&&(this.options[b]=a[b])},get:function(a){return this.options[a]},_drawBase:function(){this._context2d.save(),this._context2d.fillStyle=this.get("canvasColor"),this._context2d.fillRect(0,0,this.get("width")+1,this.get("height")+1),this._context2d.fillStyle=this.get("fontColor"),this._context2d.font="34px sans-serif",this._context2d.translate(190.5,100.5),this._context2d.strokeStyle=this.get("scaleLineColor");var a,b,c=this.get("xLength"),d=this.get("yLength"),e=this.get("yScale"),f=d/(e[e.length-1]-e[0]),g=Math.floor(c/Math.max(5,this._data.length));for(this._context2d.beginPath(),this._context2d.lineWidth=this.get("xyLineWidth"),this._context2d.moveTo(0,0),this._context2d.lineTo(0,d+20),this._context2d.stroke(),b=0;b<e.length;b++)a=Math.round(d-(e[b]-e[0])*f),this._context2d.beginPath(),this._context2d.save(),this._context2d.moveTo(-20,a),this._context2d.lineTo(c,a),this._context2d.fillText(e[b],-70,a+10),b>0?(this._context2d.setLineDash([5,5]),this._context2d.lineWidth=this.get("scaleLineWidth")):this._context2d.lineWidth=this.get("xyLineWidth"),this._context2d.stroke(),this._context2d.restore();for(this._context2d.beginPath(),b=g;c>=b;)this._context2d.moveTo(b,d),this._context2d.lineTo(b,d+20),b+=g;this._context2d.stroke(),this._context2d.restore()},_drawData:function(){this._context2d.save(),this._context2d.translate(190.5,100.5);var a,b,c,d,e=this.get("xLength"),f=this.get("yLength"),g=this.get("yScale"),h=this._data,i=f/(g[g.length-1]-g[0]),j=0,k=Math.floor(e/Math.max(5,this._data.length)),l=this.get("barWidth")*k,m=(1-this.get("barWidth"))/2*k,n=[];for(j=0;j<h.length;j++)""!==h[j].value&&(b=Math.round(f-(h[j].value-g[0])*i),"bar"==this.get("type")?(a=m+j*k,this._context2d.fillStyle=this.get("barColor"),this._context2d.lineWidth=5,this._context2d.fillRect(a,b,l,h[j].value*i),this._context2d.strokeRect(a,b,l,h[j].value*i)):"line"==this.get("type")&&(a=Math.round(k/2+j*k),n.push([a,b])),this._context2d.fillStyle=this.get("fontColor"),this._context2d.font="34px sans-serif",c=h[j].label.split("-"),d=this._context2d.measureText(c[1]+"/"+c[2]),this._context2d.fillText(c[1]+"/"+c[2],Math.round(j*k+(k-d.width)/2),f+60),d=this._context2d.measureText(c[0]),this._context2d.fillText(c[0],Math.round(j*k+(k-d.width)/2),f+100));"line"==this.get("type")&&n.length&&(this._drawBrokenLine(n),this.get("dot")&&this._drawDot(n)),this._context2d.restore()},_drawBrokenLine:function(a){this._context2d.save(),this._context2d.strokeStyle=this.get("brokenLineColor"),this._context2d.lineWidth=this.get("brokenLineWidth"),this._context2d.lineJoin="round",this._context2d.beginPath();for(var b=0;b<a.length;b++)0==b?this._context2d.moveTo(a[b][0],a[b][1]):this._context2d.lineTo(a[b][0],a[b][1]);this._context2d.stroke(),this._context2d.restore()},_drawDot:function(a){this._context2d.save(),this._context2d.strokeStyle=this.get("dotStrokeColor"),this._context2d.lineWidth=this.get("dotStrokeWidth"),this._context2d.fillStyle=this.get("dotColor");for(var b=0;b<a.length;b++)this._context2d.beginPath(),this._context2d.arc(a[b][0],a[b][1],this.get("dotRadius"),0,2*Math.PI,!1),this._context2d.closePath(),this._context2d.stroke(),this._context2d.fill();this._context2d.restore()},_drawYTitle:function(){this._context2d.save(),this._context2d.fillStyle=this.get("fontColor"),this._context2d.translate(70,Math.round(this.get("yLength")/5*4)),this._context2d.rotate(-90*(Math.PI/180)),this._context2d.font="44px sans-serif",this._context2d.fillText(this.get("yTitle"),0,0),this._context2d.restore()},_drawXTitle:function(){this._context2d.save(),this._context2d.fillStyle=this.get("fontColor"),this._context2d.font="44px sans-serif",this._context2d.fillText(this.get("xTitle"),Math.round(this.get("width")/7*3),this.get("height")-60),this._context2d.restore()}},a.CyberChart=b}(this);