/*
* Project: CyberChart
* Version: 1.2.0 (2013-12-30 17:17)
* Development By: Jasper <jasperke@kinghood.com.tw>
* Copyright(c): 2013 Jasper Ke All rights reserved.
*/
!function(a){"use strict";function b(a,b,c){this._element="string"==typeof a?$("#"+a):$(a),this._data=b,this.options={width:1e3,height:840,barWidth:.6,xTitle:"",yTitle:"",margin:[100,50,240,190],xyLineWidth:2,yScale:[0,5,10,15,20,25,30],yScaleSize:20,xScaleSize:10,xScalePos:"between",type:"bar",barColor:"rgba(180,180,180,0.7)",canvasColor:"#ffffff",brokenLineColor:"rgba(160,160,160,0.7)",brokenLineWidth:16,alwaysLine:!0,dot:!0,dotColor:"#ffffff",dotStrokeWidth:12,dotStrokeColor:"rgba(100,100,100,0.7)",dotRadius:7,scaleLineColor:"#000000",scaleLineWidth:2,xLabel:function(a){return[a]},fontColor:"#000000"},this.yScaleLabelMaxWidth=0,this.xScaleLabelMaxHeight=0,$.extend(this.options,c),this._prepare()}var c=a.CyberChart;b.prefixZero=function(a){return a>=10?a:"0"+a},b.noConflict=function(){return a.CyberChart=c,b},b.prototype={_prepare:function(){var a,b=this.get("margin");this.set({xLength:this.get("width")-b[3]-b[1],yLength:this.get("height")-b[0]-b[2]}),a=$("<canvas/>").attr({width:this.get("width"),height:this.get("height")}).appendTo(this._element),this._context2d=a.get(0).getContext("2d"),this._context2d.setLineDash||(this._context2d.setLineDash=$.proxy(function(a){this._context2d.mozDash=a,this._context2d.webkitLineDash=a},this)),this._drawBase(),this._drawXTitle(),this._drawYTitle(),this._drawData()},_setLineDashOffset:function(a){this._context2d.lineDashOffset=a,this._context2d.mozDashOffset=a,this._context2d.webkitLineDashOffset=a},set:function(a){for(var b in a)a.hasOwnProperty(b)&&(this.options[b]=a[b])},get:function(a){return this.options[a]},_drawBase:function(){var a,b,c,d=this.get("margin"),e=this.get("xLength"),f=this.get("yLength"),g=this.get("yScale"),h=f/(g[g.length-1]-g[0]),i=Math.floor(e/Math.max(5,this._data.length));for(this._context2d.save(),this._context2d.fillStyle=this.get("canvasColor"),this._context2d.fillRect(0,0,this.get("width")+1,this.get("height")+1),this._context2d.fillStyle=this.get("fontColor"),this._context2d.font="34px sans-serif",this._context2d.translate(d[3]+.5,d[0]+.5),this._context2d.strokeStyle=this.get("scaleLineColor"),this._context2d.beginPath(),this._context2d.lineWidth=this.get("xyLineWidth"),this._context2d.moveTo(0,0),this._context2d.lineTo(0,f+this.get("xScaleSize")),this._context2d.stroke(),c={width:null,height:this._context2d.measureText("H").width},b=0;b<g.length;b++)a=Math.round(f-(g[b]-g[0])*h),this._context2d.beginPath(),this._context2d.save(),this._context2d.moveTo(-this.get("yScaleSize"),a),this._context2d.lineTo(e,a),c.width=this._context2d.measureText(g[b]).width,this.yScaleLabelMaxWidth=Math.max(this.yScaleLabelMaxWidth,c.width),this._context2d.fillText(g[b],-this.get("yScaleSize")-c.width-10,a+c.height/2),b>0?(this._context2d.setLineDash([5,5]),this._context2d.lineWidth=this.get("scaleLineWidth")):this._context2d.lineWidth=this.get("xyLineWidth"),this._context2d.stroke(),this._context2d.restore();if(this.get("xScaleSize")){for(this._context2d.beginPath(),b="center"==this.get("xScalePos")?Math.round(i/2):i;e>=b;)this._context2d.moveTo(b,f),this._context2d.lineTo(b,f+this.get("xScaleSize")),b+=i;this._context2d.stroke()}this._context2d.restore()},_drawData:function(){var a,b,c,d=this.get("xLength"),e=this.get("yLength"),f=this.get("yScale"),g=this.get("margin"),h=this._data,i=e/(f[f.length-1]-f[0]),j=0,k=0,l=Math.floor(d/Math.max(5,this._data.length)),m=this.get("barWidth")*l,n=(1-this.get("barWidth"))/2*l,o=[],p=[];for(this._context2d.save(),this._context2d.translate(g[3]+.5,g[0]+.5),j=0;j<h.length;j++)for(""!==h[j].value?(b=Math.round(e-(h[j].value-f[0])*i),"bar"==this.get("type")?(a=n+j*l,this._context2d.fillStyle=this.get("barColor"),this._context2d.lineWidth=5,this._context2d.fillRect(a,b,m,h[j].value*i),this._context2d.strokeRect(a,b,m,h[j].value*i)):"line"==this.get("type")&&(a=Math.round(l/2+j*l),o.push([a,b]))):"line"!=this.get("type")||this.get("alwaysLine")||o.push(null),this._context2d.fillStyle=this.get("fontColor"),this._context2d.font="34px sans-serif",p=this.get("xLabel")(h[j].label),this.xScaleLabelMaxHeight=this._context2d.measureText("H").width*p.length,k=0;k<p.length;k++)c=this._context2d.measureText(p[k]),a=Math.round(j*l+(l-c.width)/2),b=e+this.get("xScaleSize")+10+this._context2d.measureText("H").width*(k+1)+10*k,this._context2d.fillText(p[k],a,b);"line"==this.get("type")&&o.length&&(this._drawBrokenLine(o),this.get("dot")&&this._drawDot(o)),this._context2d.restore()},_drawBrokenLine:function(a){this._context2d.save(),this._context2d.strokeStyle=this.get("brokenLineColor"),this._context2d.lineWidth=this.get("brokenLineWidth"),this._context2d.lineJoin="round";var b=!0;this._context2d.beginPath();for(var c=0;c<a.length;c++)b?(this._context2d.moveTo(a[c][0],a[c][1]),b=!1):null===a[c]?b=!0:this._context2d.lineTo(a[c][0],a[c][1]);this._context2d.stroke(),this._context2d.restore()},_drawDot:function(a){this._context2d.save(),this._context2d.strokeStyle=this.get("dotStrokeColor"),this._context2d.lineWidth=this.get("dotStrokeWidth"),this._context2d.fillStyle=this.get("dotColor");for(var b=0;b<a.length;b++)null!==a[b]&&(this._context2d.beginPath(),this._context2d.arc(a[b][0],a[b][1],this.get("dotRadius"),0,2*Math.PI,!1),this._context2d.closePath(),this._context2d.stroke(),this._context2d.fill());this._context2d.restore()},_drawYTitle:function(){this._context2d.save(),this._context2d.fillStyle=this.get("fontColor"),this._context2d.font="44px sans-serif";var a=this._context2d.measureText(this.get("yTitle")).width,b=this._context2d.measureText("H").width,c=this.get("margin");this._context2d.translate((c[3]-10-this.get("yScaleSize")-this.yScaleLabelMaxWidth-b)/2+b,Math.round(a+(this.get("yLength")-a)/2)+c[0]),this._context2d.rotate(-90*(Math.PI/180)),this._context2d.fillText(this.get("yTitle"),0,0),this._context2d.restore()},_drawXTitle:function(){this._context2d.save(),this._context2d.fillStyle=this.get("fontColor"),this._context2d.font="44px sans-serif";var a=this._context2d.measureText(this.get("xTitle")).width,b=this.get("margin");this._context2d.fillText(this.get("xTitle"),Math.round(b[3]+(this.get("xLength")-a)/2),this.get("height")-60),this._context2d.restore()}},a.CyberChart=b}(this);